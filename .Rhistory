meta(corpus[[1]])
corpus[, "identifier"]
names(corpus)
sampledtm[, "identifier"]
names(sampledtm)
sampledtm$v
names(sampledtm)
sampledtm$dimnames
names(sampledtm)
meta(corpus)
meta(corpus[[1]])
meta(corpus[[1]], tag=Heading)
meta(corpus[[1]], tag="Heading")
meta(corpus, tag="Heading")
require(tm)
require(slam)
require(topicmodels)
require(ggplot2)
load("~/Dropbox/gh_projects/uk_govt_web_archive/data/lda_models.Rdata")
load("~/Dropbox/gh_projects/uk_govt_web_archive/data/sampledtm.Rdata")
load("~/Dropbox/gh_projects/uk_govt_web_archive/data/globalisation_corpus.Rdata")
options(scipen=999)
perplexity <- as.data.frame(as.matrix(lapply(lda.models, perplexity)))
perplexity$Perplexity<-as.numeric(perplexity$V1)
perplexity$K<-c(5, 50, 100, 400, 1000)
ggplot(perplexity, aes(x=K, y=Perplexity)) + geom_line() + theme_bw()
ldamodel<-lda.models[[3]]
terms(ldamodel, 10)
terms<-terms(ldamodel, 10)
terms
terms[,1]
terms[1,]
install.packages("rticles")
install.packages("rticles")
devtools::install_github("rstudio/rticles")
install.packages("rstudio")
install.packages("devtools")
devtools::install_github("rstudio/rticles")
n <- 200
set.seed(101)
sd.value <- 1
X1 <- rnorm(n, 0, 1)
X2 <- rnorm(n, 0, 1)
Y <- rnorm(n, (5 + 3*X1 - 2*X2), sd.value)
simdata <- data.frame(X1, X2, Y)
summary(lm(Y ~ X1 + X2, data=simdata))
?binom
?rbinom
X3 <- rnorm(n, 0, 1)
Y <- rnorm(n, (0 + 2*X1 + 2*X2 + X3*X3), sd.value)
simdata <- data.frame(X1, X2, Y)
summary(lm(Y ~ X1 + X2 + X3, data=simdata))
summary(lm(Y ~ X1 + X2 + X3 + X3*X3, data=simdata))
simdata <- data.frame(X1, X2, X3, Y)
summary(lm(Y ~ X1 + X2 + X3 + X3*X3, data=simdata))
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3*X3, data=simdata))
summary(lm(Y ~ X1 + X2 + X3 + X3X3, data=simdata))
Y <- rnorm(n, (0 + 2*X1 + 2*X2 + 2X3*2X3), sd.value)
simdata <- data.frame(X1, X2, X3, Y)
x1 <- 11:30
x2 <- runif(20,5,95)
x3 <- rbinom(20,1,.5)
b0 <- 17
b1 <- 0.5
b2 <- 0.037
b3 <- -5.2
sigma <- 1.4
eps <- rnorm(x1,0,sigma)
y <- b0 + b1*x1  + b2*x2  + b3*x3 + eps
summary(lm(y~x1+x2+x3))
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
set.seed(666)
x1 = rnorm(1000)           # some continuous variables
x2 = rnorm(1000)
x1 = rnorm(1000)           # some continuous variables
x2 = rnorm(1000)
z = 1 + 2*x1 + 3*x2        # linear combination with a bias
pr = 1/(1+exp(-z))         # pass through an inv-logit function
y = rbinom(1000,1,pr)      # bernoulli response variable
#now feed it to glm:
df = data.frame(y=y,x1=x1,x2=x2)
glm( y~x1+x2,data=df,family="binomial")
model<-glm( y~x1+x2,data=df,family="binomial")
summary(model)
x3 = rnorm(1000)
2*x3*x3
plot(2*x3*x3)
plot(2*x3*-2*x3)
x = seq(0,1,length=11)
y = sin(2*pi*x) + rnorm(11, sd=0.3)
plot(x,y)
x = seq(0,1,length=1000)
y = sin(2*pi*x) + rnorm(1000, sd=0.3)
plot(x,y)
y = sin(pi*x) + rnorm(1000, sd=0.3)
plot(x,y)
?sin
y = sin(x) + rnorm(1000, sd=0.3)
plot(x,y)
y = sin(2*x) + rnorm(1000, sd=0.3)
plot(x,y)
y = sin(2*x) + rnorm(1000, sd=0.3)
## plot it
y = sin(2*2*x) + rnorm(1000, sd=0.3)
plot(x,y)
?pi
y = sin(-2*2*x) + rnorm(1000, sd=0.3)
plot(x,y)
y = sin(4*4*x) + rnorm(1000, sd=0.3)
plot(x,y)
y = sin(2*2*x) + rnorm(1000, sd=0.3)
plot(x,y)
set.seed(666)
x = seq(0,1,length=1000)
y = sin(2*2*x) + rnorm(1000, sd=0.3)
plot(x,y)
lm1 = lm(y~x)
summary(lm1)
lm10 = lm(y~x
+I(x^2)+I(x^3)+I(x^4)+I(x^5)+I(x^6)+I(x^7)+I(x^8)+I(x^9)+I(x^10))
lm9 = lm(y~x
+I(x^2)+I(x^3)+I(x^4)+I(x^5)+I(x^6)+I(x^7)+I(x^8)+I(x^9))
lm8 = lm(y~x+I(x^2)+I(x^3)+I(x^4)+I(x^5)+I(x^6)+I(x^7)+I(x^8))
lm7 = lm(y~x+I(x^2)+I(x^3)+I(x^4)+I(x^5)+I(x^6)+I(x^7))
lm6 = lm(y~x+I(x^2)+I(x^3)+I(x^4)+I(x^5)+I(x^6))
lm5 = lm(y~x+I(x^2)+I(x^3)+I(x^4)+I(x^5))
lm4 = lm(y~x+I(x^2)+I(x^3)+I(x^4))
lm3= lm(y~x+I(x^2)+I(x^3))
lm2 = lm(y~x+I(x^2))
?I
xplot=seq(0,1,length=200)
lines(xplot,predict(lm3,newdata=data.frame(x=xplot)), col="blue")
lines(xplot,predict(lm2,newdata=data.frame(x=xplot)), col="red")
lines(xplot,predict(lm5,newdata=data.frame(x=xplot)), col="green")
for(degree in 1:10){
fm = lm(y~poly(x,degree))
assign(paste("y",degree,sep="."),fm) # this isn't needed, but
handy
lines(xplot,predict(fm,data.frame(x=xplot)), col=degree)
}
for(degree in 1:10){
fm = lm(y~poly(x,degree))
assign(paste("y",degree,sep="."),fm) # this isn't needed, but handy
lines(xplot,predict(fm,data.frame(x=xplot)), col=degree)
}
lines(xplot,sin(2*pi*xplot),col="gray")
lines(xplot,sin(2*2*xplot),col="gray")
lines(xplot,sin(2*2*xplot),col="gray")
lines(xplot,sin(2*2*xplot),col="gray")
lms = list(lm1,lm2,lm3,lm4,lm5,lm6,lm7,lm8,lm9,lm10)
train = test = rep(0,10) # train = vector(length=10) also works
for(i in 1:10){train[i]=var(lms[i][[1]]$residuals)}
# now compute similarly scaled prediction error for test data
newy = sin(2*2*x)+rnorm(11,sd=.3) # note we used the same x's
for(j in 1:10){test[j] = (1/10)*sum((newy-predict(lms[j]
[[1]],newdata=data.frame(x)))^2)}
for(i in 1:10){train[i]=var(lms[i][[1]]$residuals)}
# now compute similarly scaled prediction error for test data
newy = sin(2*2*x)+rnorm(1000,sd=.3) # note we used the same x's
for(j in 1:10){test[j] = (1/10)*sum((newy-predict(lms[j]
[[1]],newdata=data.frame(x)))^2)}
plot(1:10,train, ylim=c(0,.5))
points(1:10,test,pch="X")cbind(train,test)
points(1:10,test,pch="X")
cbind(train,test)
sin(4*X3)
plot(sin(4*X3))
plot(sin(2*2*X3))
X3 <- sin(2*2*X2) + rnorm(n, 0, sd=1)
plot(X3)
X3 <- rnorm(n, 0, 1)
X1 <- rnorm(n, 0, 1)
X2 <- rnorm(n, 0, 1)
X3 <- rnorm(n, 0, 1)
n <- 1000
n <- 1000
set.seed(101)
sd.value <- 1
X1 <- rnorm(n, 0, 1)
X2 <- rnorm(n, 0, 1)
X3 <- rnorm(n, 0, 1)
Y <- rnorm(n, (0 + 2*X1 + 2*X2 + sin(2*2*X3)), sd.value)
simdata <- data.frame(X1, X2, X3, Y)
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3*X3, data=simdata))
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3*X3, data=simdata))
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
simdata <- data.frame(X1, X2, X3, Y)
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
Y <- rnorm(n, (0 + 2*X1 + 2*X2 + 2*X3 + sin(2*2*X3)), sd.value)
simdata <- data.frame(X1, X2, X3, Y)
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
Y <- rnorm(n, (0 + 2*X1 + 2*X2 + 2*X3 + 2*sin(2*2*X3)), sd.value)
simdata <- data.frame(X1, X2, X3, Y)
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
library(gdata)
library(mgcv)
Data=read.xls("http://www.pnas.org/content/suppl/2014/05/30/1402786111.DCSupplemental/pnas.1402786111.sd01.xlsx", nrows=92, as.is=TRUE)
View(Data)
Data$Category=factor(Data$Category)
Data$Gender_MF=factor(Data$Gender_MF)
Data$ColourMF=c("blue", "red")[as.numeric(Data$Gender_MF)]
BigH=which(Data$alldeaths>100) # Select hurricanes with > 100 deaths
Data$Minpressure.2014.sc=scale(Data$Minpressure_Updated.2014)
Data$NDAM.sc=scale(Data$NDAM)
Data$MasFem.sc=scale(Data$MasFem)
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(1984, 200, c("Male", "Female"), fill=c("lightblue", "pink"))
Data$ColourMF=c("blue", "pink")[as.numeric(Data$Gender_MF)]
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
legend(2000, 225, c("Male", "Female"), fill=c("blue", "pink"))
legend(2000, 240, c("Male", "Female"), fill=c("blue", "pink"))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
View(Data)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
plot((Data$NDAM), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Normalized Damage", ylab="Residuals", main="Model fit of normalized damage")
text((Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(4e4, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc +NDAM.sq), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
Data$NDAM.sqrt.sc=scale(sqrt(Data$NDAM))
Data$NDAM.abs=Data$NDAM.sqrt^2
modJSVH.sqrt=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sqrt.sc+NDAM.abs), data=Data, family=negbin(theta=c(0.2,10)))
# Fit model with sqrt(NDAM) and sqrt(NDAM)^2. The latter is also abs(NDAM.sc)
Data$NDAM.sqrt.sc=scale(sqrt(Data$NDAM))
Data$NDAM.abs=Data$NDAM.sqrt^2
modJSVH.sqrt=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sqrt.sc+NDAM.abs), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sqrt)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sqrt)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sqrt)), 0.5+max(resid(modJSVH.sqrt))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sqrt), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sqrt)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
summary(modJSVH.sqrt)
modJSVH.gender=gam(alldeaths~Gender_MF*(Minpressure.2014.sc+NDAM.sc), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
View(Data)
View(Data)
subset(Data, Gender_MF==1)
females<-subset(Data, Gender_MF==1)
males<-subset(Data, Gender_MF==1)
males<-subset(Data, Gender_MF==0)
summary(males$alldeaths)
summary(females$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
plot(Data$NDAM, Data$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
View(Data)
Data$l.deaths<-lag(Data$alldeaths)
View(Data)
Data$alldeaths<-as.ts(Data$alldeaths)
Data$l.deaths<-lag(Data$alldeaths)
View(Data)
Data$l.deaths<-lag(Data$alldeaths, lag=1)
View(Data)
?lag
Data$l.deaths<-lag(Data$alldeaths, k=1)
View(Data)
?as.ts.
?as.ts
View(Data)
Data$Year<-as.ts(Data$Year)
Data$l.deaths<-lag(Data$alldeaths, k=1)
View(Data)
source(~/Dropbox/R code/shift.R)
source("~/Dropbox/R code/shift.R")
Data$l.deaths<-shift(Data$alldeaths)
Data$l.deaths<-shift(Data$alldeaths, -1)
View(Data)
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
View(Data)
Data<-Data[complete.cases(Data)]
Data<-Data[complete.cases(Data),]
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
View(females)
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
library(gdata)
library(mgcv)
source("~/Dropbox/R code/shift.R")
# Read in the data
Data=read.xls("http://www.pnas.org/content/suppl/2014/05/30/1402786111.DCSupplemental/pnas.1402786111.sd01.xlsx", nrows=92, as.is=TRUE)
Data$Category=factor(Data$Category)
Data$Gender_MF=factor(Data$Gender_MF)
Data$ColourMF=c("blue", "pink")[as.numeric(Data$Gender_MF)]
BigH=which(Data$alldeaths>100) # Select hurricanes with > 100 deaths
# scale the covariates
Data$Minpressure.2014.sc=scale(Data$Minpressure_Updated.2014)
Data$NDAM.sc=scale(Data$NDAM)
Data$MasFem.sc=scale(Data$MasFem)
Data$l.deaths<-shift(Data$alldeaths, -1)
Data<-Data[complete.cases(Data),]
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
Data=read.xls("http://www.pnas.org/content/suppl/2014/05/30/1402786111.DCSupplemental/pnas.1402786111.sd01.xlsx", nrows=92, as.is=TRUE)
Data$Category=factor(Data$Category)
Data$Gender_MF=factor(Data$Gender_MF)
Data$ColourMF=c("blue", "pink")[as.numeric(Data$Gender_MF)]
# scale the covariates
Data$Minpressure.2014.sc=scale(Data$Minpressure_Updated.2014)
Data$NDAM.sc=scale(Data$NDAM)
Data$MasFem.sc=scale(Data$MasFem)
Data$l.deaths<-shift(Data$alldeaths, -1)
Data<-Data[complete.cases(Data),]
BigH=which(Data$alldeaths>100) # Select hurricanes with > 100 deaths
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
plot((Data$NDAM), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Normalized Damage", ylab="Residuals", main="Model fit of normalized damage")
text((Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(4e4, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc +NDAM.sq), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc +NDAM.sq) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sq)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sq)), 0.5+max(resid(modJSVH.sq))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sq), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sq)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc +NDAM.sq) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sq)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sq)), 0.5+max(resid(modJSVH.sq))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sq), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sq)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
Data$NDAM.sqrt.sc=scale(sqrt(Data$NDAM))
Data$NDAM.abs=Data$NDAM.sqrt^2
modJSVH.sqrt=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sqrt.sc+NDAM.abs), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sqrt)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sqrt)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sqrt)), 0.5+max(resid(modJSVH.sqrt))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sqrt), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sqrt)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
plot((Data$NDAM), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Normalized Damage", ylab="Residuals", main="Model fit of normalized damage")
text((Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(4e4, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc+l.deaths), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
plot((Data$NDAM), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Normalized Damage", ylab="Residuals", main="Model fit of normalized damage")
text((Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(4e4, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc+NDAM.sq+l.deaths), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sq)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sq)), 0.5+max(resid(modJSVH.sq))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sq), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sq)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
Data$NDAM.sqrt.sc=scale(sqrt(Data$NDAM))
Data$NDAM.abs=Data$NDAM.sqrt^2
modJSVH.sqrt=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sqrt.sc+NDAM.abs), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sqrt)
setwd("~/Dropbox/gh_projects/media_civil_war")
require(ggplot2)
require(reshape2)
require(foreign)
require(Zelig)
require(stargazer)
require(arm)
warren<-read.csv("data/warren.csv")
View(warren)
unique(warren$country)
length(unique(warren$country))
length(unique(warren$year))
min(warren$year)
max(warren$year)
length(unique(warren$country))
length(unique(warren$country))
length(unique(warren$year))
