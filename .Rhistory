# now compute similarly scaled prediction error for test data
newy = sin(2*2*x)+rnorm(1000,sd=.3) # note we used the same x's
for(j in 1:10){test[j] = (1/10)*sum((newy-predict(lms[j]
[[1]],newdata=data.frame(x)))^2)}
plot(1:10,train, ylim=c(0,.5))
points(1:10,test,pch="X")cbind(train,test)
points(1:10,test,pch="X")
cbind(train,test)
sin(4*X3)
plot(sin(4*X3))
plot(sin(2*2*X3))
X3 <- sin(2*2*X2) + rnorm(n, 0, sd=1)
plot(X3)
X3 <- rnorm(n, 0, 1)
X1 <- rnorm(n, 0, 1)
X2 <- rnorm(n, 0, 1)
X3 <- rnorm(n, 0, 1)
n <- 1000
n <- 1000
set.seed(101)
sd.value <- 1
X1 <- rnorm(n, 0, 1)
X2 <- rnorm(n, 0, 1)
X3 <- rnorm(n, 0, 1)
Y <- rnorm(n, (0 + 2*X1 + 2*X2 + sin(2*2*X3)), sd.value)
simdata <- data.frame(X1, X2, X3, Y)
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3*X3, data=simdata))
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3*X3, data=simdata))
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
simdata <- data.frame(X1, X2, X3, Y)
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
Y <- rnorm(n, (0 + 2*X1 + 2*X2 + 2*X3 + sin(2*2*X3)), sd.value)
simdata <- data.frame(X1, X2, X3, Y)
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
Y <- rnorm(n, (0 + 2*X1 + 2*X2 + 2*X3 + 2*sin(2*2*X3)), sd.value)
simdata <- data.frame(X1, X2, X3, Y)
simdata$X3X3<-simdata$X3*simdata$X3
summary(lm(Y ~ X1 + X2 + X3 + X3 + X3X3, data=simdata))
library(gdata)
library(mgcv)
Data=read.xls("http://www.pnas.org/content/suppl/2014/05/30/1402786111.DCSupplemental/pnas.1402786111.sd01.xlsx", nrows=92, as.is=TRUE)
View(Data)
Data$Category=factor(Data$Category)
Data$Gender_MF=factor(Data$Gender_MF)
Data$ColourMF=c("blue", "red")[as.numeric(Data$Gender_MF)]
BigH=which(Data$alldeaths>100) # Select hurricanes with > 100 deaths
Data$Minpressure.2014.sc=scale(Data$Minpressure_Updated.2014)
Data$NDAM.sc=scale(Data$NDAM)
Data$MasFem.sc=scale(Data$MasFem)
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(1984, 200, c("Male", "Female"), fill=c("lightblue", "pink"))
Data$ColourMF=c("blue", "pink")[as.numeric(Data$Gender_MF)]
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
legend(2000, 225, c("Male", "Female"), fill=c("blue", "pink"))
legend(2000, 240, c("Male", "Female"), fill=c("blue", "pink"))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
View(Data)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
plot((Data$NDAM), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Normalized Damage", ylab="Residuals", main="Model fit of normalized damage")
text((Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(4e4, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc +NDAM.sq), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
Data$NDAM.sqrt.sc=scale(sqrt(Data$NDAM))
Data$NDAM.abs=Data$NDAM.sqrt^2
modJSVH.sqrt=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sqrt.sc+NDAM.abs), data=Data, family=negbin(theta=c(0.2,10)))
# Fit model with sqrt(NDAM) and sqrt(NDAM)^2. The latter is also abs(NDAM.sc)
Data$NDAM.sqrt.sc=scale(sqrt(Data$NDAM))
Data$NDAM.abs=Data$NDAM.sqrt^2
modJSVH.sqrt=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sqrt.sc+NDAM.abs), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sqrt)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sqrt)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sqrt)), 0.5+max(resid(modJSVH.sqrt))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sqrt), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sqrt)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
summary(modJSVH.sqrt)
modJSVH.gender=gam(alldeaths~Gender_MF*(Minpressure.2014.sc+NDAM.sc), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
View(Data)
View(Data)
subset(Data, Gender_MF==1)
females<-subset(Data, Gender_MF==1)
males<-subset(Data, Gender_MF==1)
males<-subset(Data, Gender_MF==0)
summary(males$alldeaths)
summary(females$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
plot(Data$NDAM, Data$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
plot(males$NDAM, males$alldeaths)
plot(females$NDAM, females$alldeaths)
View(Data)
Data$l.deaths<-lag(Data$alldeaths)
View(Data)
Data$alldeaths<-as.ts(Data$alldeaths)
Data$l.deaths<-lag(Data$alldeaths)
View(Data)
Data$l.deaths<-lag(Data$alldeaths, lag=1)
View(Data)
?lag
Data$l.deaths<-lag(Data$alldeaths, k=1)
View(Data)
?as.ts.
?as.ts
View(Data)
Data$Year<-as.ts(Data$Year)
Data$l.deaths<-lag(Data$alldeaths, k=1)
View(Data)
source(~/Dropbox/R code/shift.R)
source("~/Dropbox/R code/shift.R")
Data$l.deaths<-shift(Data$alldeaths)
Data$l.deaths<-shift(Data$alldeaths, -1)
View(Data)
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
View(Data)
Data<-Data[complete.cases(Data)]
Data<-Data[complete.cases(Data),]
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
View(females)
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
library(gdata)
library(mgcv)
source("~/Dropbox/R code/shift.R")
# Read in the data
Data=read.xls("http://www.pnas.org/content/suppl/2014/05/30/1402786111.DCSupplemental/pnas.1402786111.sd01.xlsx", nrows=92, as.is=TRUE)
Data$Category=factor(Data$Category)
Data$Gender_MF=factor(Data$Gender_MF)
Data$ColourMF=c("blue", "pink")[as.numeric(Data$Gender_MF)]
BigH=which(Data$alldeaths>100) # Select hurricanes with > 100 deaths
# scale the covariates
Data$Minpressure.2014.sc=scale(Data$Minpressure_Updated.2014)
Data$NDAM.sc=scale(Data$NDAM)
Data$MasFem.sc=scale(Data$MasFem)
Data$l.deaths<-shift(Data$alldeaths, -1)
Data<-Data[complete.cases(Data),]
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
Data=read.xls("http://www.pnas.org/content/suppl/2014/05/30/1402786111.DCSupplemental/pnas.1402786111.sd01.xlsx", nrows=92, as.is=TRUE)
Data$Category=factor(Data$Category)
Data$Gender_MF=factor(Data$Gender_MF)
Data$ColourMF=c("blue", "pink")[as.numeric(Data$Gender_MF)]
# scale the covariates
Data$Minpressure.2014.sc=scale(Data$Minpressure_Updated.2014)
Data$NDAM.sc=scale(Data$NDAM)
Data$MasFem.sc=scale(Data$MasFem)
Data$l.deaths<-shift(Data$alldeaths, -1)
Data<-Data[complete.cases(Data),]
BigH=which(Data$alldeaths>100) # Select hurricanes with > 100 deaths
plot(Data$Year, Data$alldeaths, col=Data$ColourMF, type="p", pch=15,
xlab="Year", ylab="Number of Deaths", main="Deaths due to hurricanes in the US")
text(Data$Year[BigH], Data$alldeaths[BigH], Data$Name[BigH], adj=c(0.8,1.5))
legend(2000, 250, c("Male", "Female"), fill=c("blue", "pink"))
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
par(mfrow=c(2,1), mar=c(4.1,4.1,3,1))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
plot((Data$NDAM), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Normalized Damage", ylab="Residuals", main="Model fit of normalized damage")
text((Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(4e4, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc +NDAM.sq), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc +NDAM.sq) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sq)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sq)), 0.5+max(resid(modJSVH.sq))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sq), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sq)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc +NDAM.sq) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sq)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sq)), 0.5+max(resid(modJSVH.sq))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sq), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sq)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
Data$NDAM.sqrt.sc=scale(sqrt(Data$NDAM))
Data$NDAM.abs=Data$NDAM.sqrt^2
modJSVH.sqrt=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sqrt.sc+NDAM.abs), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sqrt)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sqrt)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sqrt)), 0.5+max(resid(modJSVH.sqrt))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sqrt), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sqrt)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc) + l.deaths, data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
plot((Data$NDAM), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Normalized Damage", ylab="Residuals", main="Model fit of normalized damage")
text((Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(4e4, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
modJSVH=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc+l.deaths), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(log(fitted(modJSVH)), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Fitted values", ylab="Residuals", main="Residual plot against log-transformed fitted values")
text(log(fitted(modJSVH)[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.7,-0.7))
legend(1984, 200, c("Male", "Female"), fill=c("blue", "pink"))
plot(Data$Minpressure_Updated.2014, resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Minimum pressure", ylab="Residuals", main="Model fit of minimum pressure")
text(Data$Minpressure_Updated.2014[BigH], resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.2,-0.7))
legend(910, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
plot((Data$NDAM), resid(modJSVH), col=Data$ColourMF, ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))), pch=15,
xlab="Normalized Damage", ylab="Residuals", main="Model fit of normalized damage")
text((Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(4e4, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH)), 0.5+max(resid(modJSVH))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("lightblue", "pink"))
Data$NDAM.sq=Data$NDAM.sc^2
modJSVH.sq=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sc+NDAM.sq+l.deaths), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sq)
par(mfrow=c(1,1), mar=c(4.1,4.1,3,1))
plot(gam(resid(modJSVH.sq)~s(sqrt(Data$NDAM)), data=Data), ylim=c(min(resid(modJSVH.sq)), 0.5+max(resid(modJSVH.sq))),
xlab="Normalized Damage", ylab="Residuals", main="Model fit of (transformed) normalized damage", rug=FALSE, shade=TRUE)
points(sqrt(Data$NDAM), resid(modJSVH.sq), col=Data$ColourMF, pch=15)
text(sqrt(Data$NDAM[BigH]), resid(modJSVH.sq)[BigH], Data$Name[BigH], adj=c(0.8,-0.7))
legend(2e2, 2.8, c("Male", "Female"), fill=c("blue", "pink"))
Data$NDAM.sqrt.sc=scale(sqrt(Data$NDAM))
Data$NDAM.abs=Data$NDAM.sqrt^2
modJSVH.sqrt=gam(alldeaths~MasFem.sc*(Minpressure.2014.sc+NDAM.sqrt.sc+NDAM.abs), data=Data, family=negbin(theta=c(0.2,10)))
summary(modJSVH.sqrt)
setwd("~/Dropbox/gh_projects/media_civil_war")
require(ggplot2)
require(reshape2)
require(foreign)
require(Zelig)
require(stargazer)
require(arm)
warren<-read.csv("data/warren.csv")
model1vars<-subset(warren, select=c("country", "year", "onset", "oil2l", "mdi", "logmdi", "mdi2", "lgdpl", "larea",
"lmtn", "lpopl", "deml",
"deml2", "ethfracl", "relfracl", "pcyrs", "spline1", "spline2", "spline3"))
model1vars.unscaled<-model1vars
model1vars<-model1vars[complete.cases(model1vars),]
model1vars[-(1:4)]<-sapply(model1vars[-(1:4)], function(x) rescale(x))
detach("package:arm", unload=TRUE)
require(ZeligGAM)
### Testing non-linearity
# Using MGCV
rep.model.lin.log <- gam(onset ~ logmdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=model1vars,
family=binomial)
# summary(rep.model.lin.log)
rep.model.nonlin <- gam(onset ~ s(logmdi) + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=model1vars,
family=binomial)
# summary(rep.model.nonlin)
anova(rep.model.lin.log, rep.model.nonlin, test="Chisq")
?stargazer
anov<-anova(rep.model.lin.log, rep.model.nonlin, test="Chisq")
stargazer(anov)
?stargazer
summary(warren$mdi)
median(warren$mdi)
median(warren$mdi, na.rm=TRUE)
sd(warren$mdi, na.rm=TRUE)
sd(warren$mdi, na.rm=TRUE) / 2
View(warren)
quantile(warren$mdi, .75, na.rm=TRUE)
quantile(warren$mdi, 75, na.rm=TRUE)
quantile(warren$mdi, .99, na.rm=TRUE)
quantile(warren$mdi, .95, na.rm=TRUE)
warren$mdi[warren$mdi>=156.9]
warren$country[warren$mdi>=156.9]
unique(warren$country[warren$mdi>=156.9])
quantile(warren$mdi, .90, na.rm=TRUE)
quantile(warren$mdi, .92, na.rm=TRUE)
quantile(warren$mdi, .94, na.rm=TRUE)
quantile(warren$mdi, .95, na.rm=TRUE)
?quantile
ecdf(warren$mdi, .95, na.rm=TRUE)
ecdf(warren$mdi)
ecdf(warren$mdi, 80)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=model1vars,
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
options(scipen=999)
summary(rep.model)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<150),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<50),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
median(warren$mdi, na.rm=TRUE)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<23),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
belowmed<-subset(model1vars, mdi<23)
View(belowmed)
belowmed<-subset(model1vars, mdi<20)
View(model1vars.unscaled)
View(model1vars)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .5, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
summary(rep.model)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .9, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .75, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .5, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .6, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
rep.model<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .3, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.model)
rep.belowmed<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .9, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.belowmed)
rep.belowmed<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .75, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.belowmed)
rep.belowmed<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .65, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.belowmed)
rep.belowmed<-zelig(onset ~ mdi + lgdpl + larea + lmtn + lpopl + oil2l + deml +
deml2 + ethfracl + relfracl + pcyrs + spline1 + spline2 +
spline3,
data=subset(model1vars, mdi<quantile(model1vars$mdi, .60, na.rm=TRUE)),
model="relogit",
robust=TRUE,
cite=F)
summary(rep.belowmed)
